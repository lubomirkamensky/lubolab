<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Astronomical Events  &middot; Lubolab</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="Personal DWH, ">


<meta property="og:title" content="Astronomical Events  &middot; Lubolab ">
<meta property="og:site_name" content="Lubolab"/>
<meta property="og:url" content="https://lubolab.com/astronomical-events/" />
<meta property="og:locale" content="en">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2017-04-17T03:57:28&#43;02:00" />
<meta property="og:article:modified_time" content="2017-04-17T03:57:28&#43;02:00" />

  
    
<meta property="og:article:tag" content="Personal DWH">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@LubomirKamensky" />
<meta name="twitter:creator" content="@LubomirKamensky" />
<meta name="twitter:title" content="Astronomical Events" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://lubolab.com/astronomical-events/" />
<meta name="twitter:domain" content="https://lubolab.com/">
  

  



<link rel="canonical" href="https://lubolab.com/astronomical-events/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://lubolab.com/touch-icon-144-precomposed.png">
<link rel="icon" href="https://lubolab.com/favicon.png">
<meta name="generator" content="Hugo 0.47.1" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->











    
    




    



<link rel="stylesheet" href="https://lubolab.com/css/bundle.min.0daa6ad4d5e99054e856928e6cf6681fc85cc769ba610ec05d0d40db9813ec7dd34ee4100e9e7a0cf13399fcbf6a71257aedca49bad9b8b2daf00ace7d4af4a5.css" integrity="sha512-Dapq1NXpkFToVpKObPZoH8hcx2m6YQ7AXQ1A25gT7H3TTuQQDp56DPEzmfy/anEleu3KSbrZuLLa8ArOfUr0pQ==">

</head>
<body class="map[name:paper]" data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
          
          <a class="navbar-brand-img" href="https://lubolab.com/">
            <img alt="Lubolab" src="https://lubolab.com/images/lubolablogo.png">
            
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            <li class="">
              
                <a href="https://datalab.lubolab.com/" >
                  <i class='fa fa-flask'></i>
                  Datalab
                </a>
              
            </li>
            
            <li class="">
              
                <a href="https://github.com/lubomirkamensky/lubolab" >
                  <i class='fa fa-github'></i>
                  Blog Source code
                </a>
              
            </li>
            
            <li class="">
              
                <a href="https://twitter.com/LubomirKamensky" >
                  <i class='fa fa-twitter'></i>
                  Twitter
                </a>
              
            </li>
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>





<div class="container">
  <div class="row">
    <div class="col-sm-9">


      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="title-metas text-center">

    <h1>Astronomical Events
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2017-04-17">17 Apr, 2017</time>
</small>


  <small>
  &middot; Read in about 3 min
  &middot; (489 words)
  &middot; 
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flubolab.com%2fastronomical-events%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=Astronomical%20Events&amp;url=https%3a%2f%2flubolab.com%2fastronomical-events%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2flubolab.com%2fastronomical-events%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2flubolab.com%2fastronomical-events%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flubolab.com%2fastronomical-events%2f&amp;title=Astronomical%20Events" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=Astronomical%20Events&amp;body=Check out this site https%3a%2f%2flubolab.com%2fastronomical-events%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  </small>

<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="https://lubolab.com/tags/personal-dwh" class="label label-primary">Personal DWH</a>
  


</div>

<br>
</div>

  </div>
</div>


      <div class="content">
  

<h3 id="personal-environment">Personal environment</h3>

<p>Personal DWH begins with data about personal environment. Weather and day length affect our activity significantly. We already have Weather Data mart created, so now it is the time to build another one on top of astronomical events.</p>

<div class="c_alert c_alert-success"><i class="fa fa-info-circle"></i> This new datamart is going to be a common pattern for extending our personal DWH with any new data area.</div>

<h3 id="the-detail-layer">The detail layer</h3>

<p>We start in our detail layer,  focusing on another <a href="http://lubolab.com/detail-layer-logical-data-model/" target="_blank">Observation subtype</a>, the Event. To get the information about the day length we introduce a sun events.</p>

<p>You can see sample Event data here:<img src="https://lubolab.com/images/2017/05/event.jpg" alt="" /></p>

<p>The whole table structure is available in public repository on GitHub here <a href="https://github.com/lubomirkamensky/personal_dwh/tree/master/detail_layer/db/tables" target="_blank">personal_dwh/tree/master/detail_layer/db/tables</a></p>

<h3 id="data-source">Data source</h3>

<p>As the source for event data we use <a href="http://aa.usno.navy.mil/data/docs/api.php" target="_blank">public Astronomical Applications API</a> provided by The United States Naval Observatory (USNO).</p>

<p>Here is sample URL requesting all Sun and Moon events for one day on location specified by coordinates: <a href="http://api.usno.navy.mil/rstt/oneday?date=05/12/2017&amp;coords=48.749015N,16.983294E&amp;tz=1" target="_blank">http://api.usno.navy.mil/rstt/oneday?date=05/12/2017&amp;coords=48.749015N,16.983294E&amp;tz=1</a></p>

<h3 id="etl-environment">ETL environment</h3>

<p>We use <a href="https://developers.google.com/apps-script/" target="_blank">Google Apps Script</a> as environment for data extraction, load and transformation (ETL) and also as job scheduler.  It is used for building both detail layer in Cloud SQL and application layer in Firebase.</p>

<h3 id="the-data-flow">The data flow</h3>

<p>The whole flow starts by loading the detail table <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/event.tbl" target="_blank">Event</a></p>

<p>We have few views in Cloud SQL  to support the detail layer load. They define the load scope. The default scope is limited by the beginning of our DWH and end of current year. Later the begining of the load scope  moves according to already loaded data. You can see the view definitions here <a href="https://github.com/lubomirkamensky/personal_dwh/tree/master/detail_layer/db/views" target="_blank">personal_dwh/tree/master/detail_layer/db/views</a>. The detail layer load in SQL cloud is driven by the content of <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/event.tbl" target="_blank">Event</a> table itself.</p>

<p>The astronomical datamart is again defined as a view. There is not so big volume of data so all hourly, daily, monthly, yearly data is derived on top of one, hourly view <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/astronomical_mart/db/views/v_daylight_length_hourly.vw" target="_blank">v_ daylight_ length_ hourly</a>.</p>

<p>All hourly, daily, monthly, yearly data is materialized in the Firebase. The load is driven by  new control table <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/astronomical_mart/db/tables/t_loaded_periods.tbl" target="_blank">t_ loaded_ periods</a>. The range of data for the actual load is defined by views <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/astronomical_mart/db/views/v_load_scope.vw" target="_blank">v_ load_ scope</a> and <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/astronomical_mart/db/views/v_load_range.vw" target="_blank">v_ load_ range</a></p>

<div class="c_alert c_alert-success"><i class="fa fa-info-circle"></i> The limitation of Google Apps Script is a time constraint for an execution. It can run for a maximum period of 4-5 minutes. As we already have load control, using load scope views,  it is not a big deal to process data in small batches, manageble in given time frame. </div>

<p>The script for loading the astro events into detail layer is here <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/jobs/gappscript/pdwh_detail_event_astro.js" target="_blank">pdwh_ detail_ event_ astro.gs</a></p>

<p>The script for building the access layer in Firebase is here <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/astronomical_mart/jobs/gappscript/firebs_meas_astro_daylight.gs" target="_blank">firebs_ meas_ astro_ daylight.gs</a></p>

<h3 id="reporting-tool">Reporting tool</h3>

<p>At the end we do small change in our <a href="http://lubolab.com/the-data-lab-web-app/" target="_blank">web app</a> to include the new data.
The change takes place in one file <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/web_app/public/src/data-view.html" target="_blank">data-view.html</a>. The dropdown menus for Subject Area, Measure and Grain will be now dynamic, generated from associative arrays measureDict and grainDict.</p>

<p>The final result you can see here <a href="https://lubolab-957a1.firebaseapp.com/" target="_blank">lubolab-957a1.firebaseapp.com</a>. Login into your gmail account is required.
<img src="https://lubolab.com/images/2017/06/astro.jpg" alt="" /></p>

</div>


      <footer>
  
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flubolab.com%2fastronomical-events%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=Astronomical%20Events&amp;url=https%3a%2f%2flubolab.com%2fastronomical-events%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2flubolab.com%2fastronomical-events%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2flubolab.com%2fastronomical-events%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flubolab.com%2fastronomical-events%2f&amp;title=Astronomical%20Events" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=Astronomical%20Events&amp;body=Check out this site https%3a%2f%2flubolab.com%2fastronomical-events%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://lubolab.com/the-data-lab-web-app/" title="Reporting: Data Lab Web App">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="https://lubolab.com/new_setup_for_this_blog/" title="New setup for this blog: Migration from Ghost to Hugo">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//lubolab.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

    </div>
    
      <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div>
  

    <div class="section">
      <header><div class="title"><b>Latest Posts</b></div></header>
      <div class="content">
        <ul>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-grafana/">Building Sensor Network: Data visualisation with Grafana</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-history/">Building Sensor Network: History layer using InfluxData</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-sms/">Building Sensor Network: SMS gateway, Node-RED and smart alerts</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-battery/">Building Sensor Network: Computer Battery Monitor</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-neurio/">Building Sensor Network: Neurio integration</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-futura/">Building Sensor Network: Jablotron Futura integration</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/iot-doorbell-bc/">IoT Doorbell: with BigClown</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-bc/">Building Sensor Network: with BigClown</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/camera-events-the-etl/">Camera Events: The ETL</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/camera-events-data-model/">Camera Events: Data Model</a>
          </li>
        
        </ul>
      </div>
    </div>

    
      
      
    
      
      
      <div class="section taxonomies">
        <header><div class="title"><b>tag</b></div></header>

        <div class="content">
          <ul>
            <li><a href="https://lubolab.com/tags/personal-dwh">personal-dwh</a></li><li><a href="https://lubolab.com/tags/bigclown">bigclown</a></li><li><a href="https://lubolab.com/tags/netatmo">netatmo</a></li><li><a href="https://lubolab.com/tags/battery-monitor2mqtt">battery-monitor2mqtt</a></li><li><a href="https://lubolab.com/tags/blogging-platform">blogging-platform</a></li><li><a href="https://lubolab.com/tags/futura">futura</a></li><li><a href="https://lubolab.com/tags/grafana">grafana</a></li><li><a href="https://lubolab.com/tags/influxdata">influxdata</a></li><li><a href="https://lubolab.com/tags/jablotron">jablotron</a></li><li><a href="https://lubolab.com/tags/json2mqtt">json2mqtt</a></li>
          </ul>
        </div>
      </div>
      
    
      
      
    

</div>

      </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

<a href="https://lubolab.com/"></a> <i>&middot;</i>

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    

    
<div class="container copyright">
    <small>
  &copy; 2018 Lubolab

  </small>
</div>



        </div>
    </div>
  </div>
</footer>

    











<script>
  var _gaq=[['_setAccount','UA-90639023-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<script>
var ENABLE_POPOVER =  false , 
EXPIRE_COOKIE =  5 , 
SHOW_MODAL_TIMEOUT =  10000 , 
MOUSE_LEAVE =  true , 
MODAL_SIZE = "", 
POST_URL = "https://zapier.com/hooks/catch/1227563/", 
SIGNUP_HEADER = "Join Our Newsletter",
HEADER_IMAGE = "//placehold.it/1000x600",
IMG_DESCRIPTION = "Placeholder image for this popover modal optin form",
SIGNUP_TEXT = "Signup today for free and be the first to get notified on new updates.",
INPUT_PLACEHOLDER = "Enter your email",
SUBMIT_BUTTON = "Subscribe",
SUCCESS_MESSAGE = "Thanks for your subscription!",
ERROR_MESSAGE = "Submitting form failed!",
OPTIN =  true ,
COOKIE_NAME = "mycookie1",
CONTENTLANGUAGE = ""; 
</script>







<script  src="https://lubolab.com/js/bundle.min.a0761bf8598edda2bb2c0e348a3160c418f2bc30908f40740ee7f30dabbdeed27d82ee58e16400badd1ae84ce7be7ce10702c9be216abe5de1cb497de995e850.js" integrity="sha512-oHYb&#43;FmO3aK7LA40ijFgxBjyvDCQj0B0DufzDau97tJ9gu5Y4WQAut0a6EznvnzhBwLJviFqvl3hy0l96ZXoUA=="></script>



<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/config/TeX-AMS-MML_HTMLorMML.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    for(var all in MathJax.Hub.getAllJax()) {
        all.SourceElement().parentNode.className += ' has-jax';

    }
});
</script>





  </body>
</html>

