<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Camera Events: Data Model  &middot; Lubolab</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="Personal DWH, Netatmo, ">


<meta property="og:title" content="Camera Events: Data Model  &middot; Lubolab ">
<meta property="og:site_name" content="Lubolab"/>
<meta property="og:url" content="https://lubolab.com/camera-events-data-model/" />
<meta property="og:locale" content="en">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2018-01-13T03:57:28&#43;02:00" />
<meta property="og:article:modified_time" content="2018-01-13T03:57:28&#43;02:00" />

  
    
<meta property="og:article:tag" content="Personal DWH">
    
<meta property="og:article:tag" content="Netatmo">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@LubomirKamensky" />
<meta name="twitter:creator" content="@LubomirKamensky" />
<meta name="twitter:title" content="Camera Events: Data Model" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://lubolab.com/camera-events-data-model/" />
<meta name="twitter:domain" content="https://lubolab.com/">
  

  



<link rel="canonical" href="https://lubolab.com/camera-events-data-model/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://lubolab.com/touch-icon-144-precomposed.png">
<link rel="icon" href="https://lubolab.com/favicon.png">
<meta name="generator" content="Hugo 0.31.1" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="https://lubolab.com/css/bootswatch/paper/bootstrap.min.css">


<link rel="stylesheet" href="https://lubolab.com/css/font-awesome.min.css">
<link rel="stylesheet" href="https://lubolab.com/css/style.css">


<link rel="stylesheet" href="https://lubolab.com/css/style_custom.css">



  <link rel="stylesheet" href="https://lubolab.com/css/highlight/default.css">


</head>
<body class="map[name:paper]" data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
          
          <a class="navbar-brand-img" href="https://lubolab.com/">
            <img alt="Lubolab" src="https://lubolab.com/images/lubolablogo.png">
            
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            <li class="">

              <a href="https://datalab.lubolab.com/" >
                <i class='fa fa-flask'></i>
                Datalab
              </a>
            </li>
            
            <li class="">

              <a href="https://github.com/lubomirkamensky/lubolab" >
                <i class='fa fa-github'></i>
                Blog Source code
              </a>
            </li>
            
            <li class="">

              <a href="https://twitter.com/LubomirKamensky" >
                <i class='fa fa-twitter'></i>
                Twitter
              </a>
            </li>
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>


<div class="container">
  <div class="row">
    <div class="col-sm-9">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="text-center">

    <h1>Camera Events: Data Model
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2018-01-13">13 Jan, 2018</time>
</small>


  <small>
  &middot; Read in about 4 min
  &middot; (653 words)
  &middot; 
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=Camera%20Events%3a%20Data%20Model&amp;url=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f&amp;title=Camera%20Events%3a%20Data%20Model" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=Camera%20Events%3a%20Data%20Model&amp;body=Check out this site https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  </small>

<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="https://lubolab.com/tags/personal-dwh" class="label label-primary">Personal DWH</a>
  
  <a href="https://lubolab.com/tags/netatmo" class="label label-primary">Netatmo</a>
  


</div>

<br>
</div>

  </div>
</div>

      <div class="content">
  

<h3 id="the-idea">The Idea</h3>

<p>I have few <a href="https://www.netatmo.com/en-US/product/security/" target="_blank">smart Netatmo cameras</a>, both indoor and outdoor. And it is quite logical to integrate them into my personal Datawarehouse. There is even <a href="https://dev.netatmo.com/resources/technical/reference/cameras" target="_blank">nice open API</a> supporting such intention.</p>

<p>The goal is to load event data into <a href="https://lubolab.com/detail-layer-logical-data-model/">detail layer</a> and store the snapshot photos in <a href="https://photos.google.com" target="_blank">Google photos</a> using the <a href="https://photos.google.com/apps" target="_blank">Google Backup and Sync</a>. Then, of course, somehow link the data with the photos.</p>

<h3 id="the-data-model-concept">The Data Model Concept</h3>

<p>This time we are going to face bit more complicated interaction with the source system. So it is worth spending some time on robust Data Model design. Our Observation model utilizes the approach of supertype and subtypes.  In fact, it offers something like Inheritance in object-oriented programming.</p>

<div class="c_alert c_alert-success"><i class="fa fa-info-circle"></i> The supertype entity contains the common properties for many related objects, while the properties specific for the particular object take place in the subtype entity. Properties can be both attributes or relations to other entities. Supertype shares the primary key (PK) with all its subtypes</div>

<p>To keep things simple we will always use surrogate keys as PK. Integers generated outside of database in ETL scripts. Never using any internal autoincrement database feature. The surrogate key is generated for the supertype entity and then provided to all its subtypes. By saying so, it is clear that we can never load data into subtype table without having loaded records in its supertype.</p>

<div class="c_alert c_alert-success"><i class="fa fa-info-circle"></i> So the supertype is the entrance point for the data coming from the source system. To simplify the communication with the source system we store here also all needed source keys. Then we don't need any external mapping tables when connecting data in our data warehouse with the source system data.</div>

<h3 id="the-dimensions">The Dimensions</h3>

<p>Let&rsquo;s start with the dimensions. We have supertype table <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/sensor.tbl" target="_blank">sensor</a>. It contains the surrogate key &laquo;Sensor_Id&raquo; which is also the PK, then &laquo;Sensor_Source_Cd&raquo; identifying the sensor in the source, then &laquo;Source_Name&raquo; identifying the source system and finally &laquo;Target_Table&raquo; which specifies the subtype table, in our case, it is the table <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/camera.tbl" target="_blank">camera</a>.
That is the typical pattern for dimension supertype. Similarly we have supertype <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/entity.tbl" target="_blank">entity</a> and its subtype <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/person.tbl" target="_blank">person</a>.</p>

<p>Then we have two small lookup tables defined directly in our data warehouse, <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/event_type.tbl" target="_blank">event_type</a> and <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/observation_label.tbl" target="_blank">observation_label</a>, which are not linked to any source and which keys are hardcoded in table DDL. Such tables, of course, don&rsquo;t need any supertype.</p>

<h3 id="the-fact-tables">The Fact tables</h3>

<p>Now, let&rsquo;s move to the fact tables. We store data about the events in table <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/camera_event.tbl" target="_blank">camera_event</a> and we can attach snapshot photos to the event using table <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/camera_snapshot.tbl" target="_blank">camera_snapshot</a>.</p>

<p>Both tables are subtypes of one supertype table <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/observation.tbl" target="_blank">observation</a></p>

<p>There is no source key generated for events in the source system. But we know the logical primary key. It is the combination of the Camera identification and the event timestamp. There cannot be more than one event coming from the particular camera at the same time.</p>

<p>Supertype <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/observation.tbl" target="_blank">observation</a> contains &laquo;Observation_Id&raquo; the surrogate key. Then &laquo;Observation_Timestamp&raquo; the source timestamp specifying the event or snapshot creation time. And also &laquo;Sensor_Id&raquo; The Sensor surrogate key, in our case primary key of the camera in the personal data warehouse. Using &laquo;Related_Observation_Id&raquo; we can relate a camera snapshot to the camera event. The field &laquo;Target_Table&raquo; specifies target table (camera_event or camera_snapshot).</p>

<p>Subtype <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/camera_event.tbl" target="_blank">camera_event</a> extends its supertype providing more specific details about the event. Classify it using &laquo;Event_type&raquo;. It can store the person identification in &laquo;Person_Id&raquo; for person events generated by a camera with face recognition. Creation time is available in the supertype as <a href="https://www.unixtimestamp.com/" target="_blank">The Unix timestamp</a>  The same value, just  transformed into Date time field is &laquo;Event_Start_Dt&raquo;.</p>

<p>Subtype <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/camera_snapshot.tbl" target="_blank">camera_snapshot</a> stores snapshot photo file name in &laquo;File_Name&raquo; and Google Drive File Id in &laquo;File_ID&raquo;.</p>

<p>The last table to mention  is <a href="https://github.com/lubomirkamensky/personal_dwh/blob/master/detail_layer/db/tables/observation_label_related.tbl" target="_blank">observation_label_related</a>.  It allows us to assign several labels to one event. The outdoor camera generates events where multiple objects are identified, like a car, person, animal. In such case, we use labeling to add all needed information to one event.</p>

</div>


      <footer>
  
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=Camera%20Events%3a%20Data%20Model&amp;url=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f&amp;title=Camera%20Events%3a%20Data%20Model" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=Camera%20Events%3a%20Data%20Model&amp;body=Check out this site https%3a%2f%2flubolab.com%2fcamera-events-data-model%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://lubolab.com/new_setup_for_this_blog/" title="New setup for this blog: Migration from Ghost to Hugo">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="https://lubolab.com/camera-events-the-etl/" title="Camera Events: The ETL">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//lubolab.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

    </div>
    
      <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div>
  

    <div class="section">
      <header><div class="title"><b>Latest Posts</b></div></header>
      <div class="content">
        <ul>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-sms/">Building Sensor Network: SMS gateway, Node-RED and smart alerts</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-battery/">Building Sensor Network: Computer Battery Monitor</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-neurio/">Building Sensor Network: Neurio integration</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-futura/">Building Sensor Network: Jablotron Futura integration</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/iot-doorbell-bc/">IoT Doorbell: with BigClown</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-bc/">Building Sensor Network: with BigClown</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/camera-events-the-etl/">Camera Events: The ETL</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/camera-events-data-model/">Camera Events: Data Model</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/new_setup_for_this_blog/">New setup for this blog: Migration from Ghost to Hugo</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/astronomical-events/">Astronomical Events</a>
          </li>
        
        </ul>
      </div>
    </div>

    
      
      
    
      
      
      <div class="section taxonomies">
        <header><div class="title"><b>tag</b></div></header>

        <div class="content">
          <ul>
            <li><a href="https://lubolab.com/tags/personal-dwh">personal-dwh</a></li><li><a href="https://lubolab.com/tags/bigclown">bigclown</a></li><li><a href="https://lubolab.com/tags/netatmo">netatmo</a></li><li><a href="https://lubolab.com/tags/battery-monitor2mqtt">battery-monitor2mqtt</a></li><li><a href="https://lubolab.com/tags/blogging-platform">blogging-platform</a></li><li><a href="https://lubolab.com/tags/futura">futura</a></li><li><a href="https://lubolab.com/tags/jablotron">jablotron</a></li><li><a href="https://lubolab.com/tags/json2mqtt">json2mqtt</a></li><li><a href="https://lubolab.com/tags/modbus2mqtt">modbus2mqtt</a></li><li><a href="https://lubolab.com/tags/neurio">neurio</a></li>
          </ul>
        </div>
      </div>
      
    
      
      
    

</div>

      </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

<a href="https://lubolab.com/"></a> <i>&middot;</i>

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    

    
<div class="container copyright">
    <small>
  &copy; 2018 Lubolab

  </small>
</div>



        </div>
    </div>
  </div>
</footer>

    

<script src="https://lubolab.com/js/jquery.min.js"></script>
<script src="https://lubolab.com/js/bootstrap.min.js"></script>


<script src="https://lubolab.com/js/highlight.pack.js"></script>
<script src="https://lubolab.com/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','UA-90639023-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<script>
var ENABLE_POPOVER =  false , 
EXPIRE_COOKIE =  5 , 
SHOW_MODAL_TIMEOUT =  10000 , 
MOUSE_LEAVE =  true , 
MODAL_SIZE = "", 
POST_URL = "https://zapier.com/hooks/catch/1227563/", 
SIGNUP_HEADER = "Join Our Newsletter",
HEADER_IMAGE = "//placehold.it/1000x600",
IMG_DESCRIPTION = "Placeholder image for this popover modal optin form",
SIGNUP_TEXT = "Signup today for free and be the first to get notified on new updates.",
INPUT_PLACEHOLDER = "Enter your email",
SUBMIT_BUTTON = "Subscribe",
SUCCESS_MESSAGE = "Thanks for your subscription!",
ERROR_MESSAGE = "Submitting form failed!",
OPTIN =  true ,
COOKIE_NAME = "mycookie1",
CONTENTLANGUAGE = ""; 
</script>





<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/config/TeX-AMS-MML_HTMLorMML.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    for(var all in MathJax.Hub.getAllJax()) {
        all.SourceElement().parentNode.className += ' has-jax';

    }
});
</script>






  </body>
</html>

