<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Building Sensor Network: Computer Battery Monitor  &middot; Lubolab</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="Personal DWH, Battery-Monitor2MQTT, ">


<meta property="og:title" content="Building Sensor Network: Computer Battery Monitor  &middot; Lubolab ">
<meta property="og:site_name" content="Lubolab"/>
<meta property="og:url" content="https://lubolab.com/building-sensor-network-battery/" />
<meta property="og:locale" content="en">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2018-02-11T03:57:28&#43;02:00" />
<meta property="og:article:modified_time" content="2018-02-11T03:57:28&#43;02:00" />

  
    
<meta property="og:article:tag" content="Personal DWH">
    
<meta property="og:article:tag" content="Battery-Monitor2MQTT">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@LubomirKamensky" />
<meta name="twitter:creator" content="@LubomirKamensky" />
<meta name="twitter:title" content="Building Sensor Network: Computer Battery Monitor" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://lubolab.com/building-sensor-network-battery/" />
<meta name="twitter:domain" content="https://lubolab.com/">
  

  



<link rel="canonical" href="https://lubolab.com/building-sensor-network-battery/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://lubolab.com/touch-icon-144-precomposed.png">
<link rel="icon" href="https://lubolab.com/favicon.png">
<meta name="generator" content="Hugo 0.25.1" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="https://lubolab.com/css/bootswatch/paper/bootstrap.min.css">


<link rel="stylesheet" href="https://lubolab.com/css/font-awesome.min.css">
<link rel="stylesheet" href="https://lubolab.com/css/style.css">


<link rel="stylesheet" href="https://lubolab.com/css/style_custom.css">



  <link rel="stylesheet" href="https://lubolab.com/css/highlight/default.css">


</head>
<body class="map[name:paper]" data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
          
          <a class="navbar-brand-img" href="https://lubolab.com/">
            <img alt="Lubolab" src="https://lubolab.com/images/lubolablogo.png">
            
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            <li class="">

              <a href="https://datalab.lubolab.com/" >
                <i class='fa fa-flask'></i>
                Datalab
              </a>
            </li>
            
            <li class="">

              <a href="https://github.com/lubomirkamensky/lubolab" >
                <i class='fa fa-github'></i>
                Blog Source code
              </a>
            </li>
            
            <li class="">

              <a href="https://twitter.com/LubomirKamensky" >
                <i class='fa fa-twitter'></i>
                Twitter
              </a>
            </li>
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>


<div class="container">
  <div class="row">
    <div class="col-sm-9">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="text-center">

    <h1>Building Sensor Network: Computer Battery Monitor
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2018-02-11">11 Feb, 2018</time>
</small>


  <small>
  &middot; Read in about 3 min
  &middot; (548 words)
  &middot; 
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=Building%20Sensor%20Network%3a%20Computer%20Battery%20Monitor&amp;url=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f&amp;title=Building%20Sensor%20Network%3a%20Computer%20Battery%20Monitor" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=Building%20Sensor%20Network%3a%20Computer%20Battery%20Monitor&amp;body=Check out this site https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  </small>

<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="https://lubolab.com/tags/personal-dwh" class="label label-primary">Personal DWH</a>
  
  <a href="https://lubolab.com/tags/battery-monitor2mqtt" class="label label-primary">Battery-Monitor2MQTT</a>
  


</div>

<br>
</div>

  </div>
</div>

      <div class="content">
  

<h3 id="battery-monitor-over-mqtt">Battery Monitor over MQTT</h3>

<p>It can sound quite obscure to publish Computer Battery status over MQTT. But I think it is on the contrary, absolutely essential thing. Let me explain.</p>

<p>In fact, I was about to write a post about smart alerts, to move finally to something really practical after so many posts focusing just on building the sensor playground. Honestly, I postponed such topic already several times. Always something popped up, what was absolutely essential to cover before moving further. And I promise this is the last time.</p>

<p>As I described in prior posts, the heart of my sensor network is a Linux tablet receiving data from all the sensors. Disconnected from power supply the tablet can continue processing sensor data several hours on the batteries.</p>

<div class="c_alert c_alert-success"><i class="fa fa-exclamation-triangle"></i> 
This is extremely important for security sensors as every experienced burglar disconnects the power supply first. But the continuity of measurement has always its value. 
</div>

<p>In case of power outage, the local network and internet access is probably out of function so it is good to have 3g usb dongle directly connected to the tablet and use it as SMS gateway for critical alerts.</p>

<div class="c_alert c_alert-success"><i class="fa fa-info-circle"></i>
I consider the event of disconnecting from the power supply to be one of the most important events in our sensor network. And that's the motivation to add the tablet battery monitor into our first access layer, MQTT.
</div>

<p>It is definitely useful to know about every power outage in our house immediately and then also to monitor the outage duration. Also, it is useful to be informed how long the tablet is going to last on the batteries.</p>

<h3 id="the-solution">The solution</h3>

<p>It is going to be just another gateway to the MQTT access layer. The approach is similar as for the prior one, <a href="https://github.com/lubomirkamensky/json2mqtt" target="_blank">json2mqtt</a>. Just instead of sourcing some external file, this time we have to gather the required information directly from our OS.</p>

<p>Okay, so the publishing part is fixed, we just need to learn how to gather the battery status information from a Linux OS. No reason to reinvent the wheel, such project is already here <a href="https://github.com/maateen/battery-monitor" target="_blank">battery-monitor</a>. Thanks for sharing <a href="https://github.com/maateen" target="_blank">Maateen</a>!</p>

<p>So I simplified and customized bit the core part of it, the class BatteryMonitor</p>

<pre><code>class BatteryMonitor:
    raw_battery_info = ''
    processed_battery_info = {}
    remainingFlag = True

    def __init__(self):
        self.raw_battery_info = self.get_raw_battery_info()
        self.get_processed_battery_info()
        self.on_ac_power = subprocess.call(['on_ac_power'])

    def get_raw_battery_info(self):
        command = &quot;acpi -b&quot;
        raw_info = subprocess.check_output(command,
                                           stderr=subprocess.PIPE,
                                           shell=True)
        return raw_info

    def get_processed_battery_info(self):
        in_list = (self.raw_battery_info.decode(&quot;utf-8&quot;, &quot;strict&quot;).lower().strip('\n')
                   .split(&quot;: &quot;, 1)[1].split(&quot;, &quot;))

        self.processed_battery_info[&quot;state&quot;] = in_list[0]
        self.processed_battery_info[&quot;percentage&quot;] = in_list[1]
        try:
            self.processed_battery_info[&quot;remaining&quot;] = in_list[2]
        except Exception as exc:
            self.remainingFlag = False

        return self.processed_battery_info
</code></pre>

<p>and placed it in the new tool <a href="https://github.com/lubomirkamensky/battery-monitor2mqtt" target="_blank">battery-monitor2mqtt</a>.</p>

<p>The usage is decribed in the <a href="https://github.com/lubomirkamensky/battery-monitor2mqtt/blob/master/README.md" target="_blank">readme file</a>.</p>

<p>Then I tested it on my chromebook, starting on power supply and then disconnected:
<img src="https://lubolab.com/images/2018/02/battery_chrome.png" alt="Chromebook" /></p>

<p>the tablet, starting on power supply and then disconnected:
<img src="https://lubolab.com/images/2018/02/battery_lubuntu.png" alt="Tablet" /></p>

<p>and finally, even it doesn&rsquo;t have much sense, on my desktop computer without batteries. Here just on power supply, I guess everybody can imagine the dead screen:
<img src="https://lubolab.com/images/2018/02/battery_ubuntu.png" alt="Desktop" /></p>

<p>Each environment surprised with something new, so the tool can hopefully cope with most of the hardware now.</p>

<p>After successful testing is the new tool just another pm2 process on the tablet.</p>

<pre><code>pm2 start /usr/bin/python3 --name &quot;battery-monitor2mqtt&quot; -- /home/luba/Git/battery-monitor2mqtt/battery-monitor2mqtt.py --mqtt-topic lubuntu
pm2 save
</code></pre>

<p>The collection is growing. Here is the complete list now:
<img src="https://lubolab.com/images/2018/02/pm2list2.png" alt="Desktop" /></p>

</div>


      <footer>
  
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=Building%20Sensor%20Network%3a%20Computer%20Battery%20Monitor&amp;url=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f&amp;title=Building%20Sensor%20Network%3a%20Computer%20Battery%20Monitor" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=Building%20Sensor%20Network%3a%20Computer%20Battery%20Monitor&amp;body=Check out this site https%3a%2f%2flubolab.com%2fbuilding-sensor-network-battery%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://lubolab.com/building-sensor-network-neurio/" title="Building Sensor Network: Neurio integration">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="https://lubolab.com/building-sensor-network-sms/" title="Building Sensor Network: SMS gateway, Node-RED and smart alerts">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//lubolab.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

    </div>
    
      <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div>
  

    <div class="section">
      <header><div class="title"><b>Latest Posts</b></div></header>
      <div class="content">
        <ul>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-history/">Building Sensor Network: History layer using InfluxData</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-sms/">Building Sensor Network: SMS gateway, Node-RED and smart alerts</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-battery/">Building Sensor Network: Computer Battery Monitor</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-neurio/">Building Sensor Network: Neurio integration</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-futura/">Building Sensor Network: Jablotron Futura integration</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/iot-doorbell-bc/">IoT Doorbell: with BigClown</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/building-sensor-network-bc/">Building Sensor Network: with BigClown</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/camera-events-the-etl/">Camera Events: The ETL</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/camera-events-data-model/">Camera Events: Data Model</a>
          </li>
        
          <li>
          <a href="https://lubolab.com/new_setup_for_this_blog/">New setup for this blog: Migration from Ghost to Hugo</a>
          </li>
        
        </ul>
      </div>
    </div>

    
      
      
    
      
      
      <div class="section taxonomies">
        <header><div class="title"><b>tag</b></div></header>

        <div class="content">
          <ul>
            <li><a href="https://lubolab.com/tags/personal-dwh">personal-dwh</a></li><li><a href="https://lubolab.com/tags/bigclown">bigclown</a></li><li><a href="https://lubolab.com/tags/netatmo">netatmo</a></li><li><a href="https://lubolab.com/tags/battery-monitor2mqtt">battery-monitor2mqtt</a></li><li><a href="https://lubolab.com/tags/blogging-platform">blogging-platform</a></li><li><a href="https://lubolab.com/tags/futura">futura</a></li><li><a href="https://lubolab.com/tags/influxdata">influxdata</a></li><li><a href="https://lubolab.com/tags/jablotron">jablotron</a></li><li><a href="https://lubolab.com/tags/json2mqtt">json2mqtt</a></li><li><a href="https://lubolab.com/tags/modbus2mqtt">modbus2mqtt</a></li>
          </ul>
        </div>
      </div>
      
    
      
      
    

</div>

      </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

<a href="https://lubolab.com/"></a> <i>&middot;</i>

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    

    
<div class="container copyright">
    <small>
  &copy; 2018 Lubolab

  </small>
</div>



        </div>
    </div>
  </div>
</footer>

    

<script src="https://lubolab.com/js/jquery.min.js"></script>
<script src="https://lubolab.com/js/bootstrap.min.js"></script>


<script src="https://lubolab.com/js/highlight.pack.js"></script>
<script src="https://lubolab.com/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','UA-90639023-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<script>
var ENABLE_POPOVER =  false , 
EXPIRE_COOKIE =  5 , 
SHOW_MODAL_TIMEOUT =  10000 , 
MOUSE_LEAVE =  true , 
MODAL_SIZE = "", 
POST_URL = "https://zapier.com/hooks/catch/1227563/", 
SIGNUP_HEADER = "Join Our Newsletter",
HEADER_IMAGE = "//placehold.it/1000x600",
IMG_DESCRIPTION = "Placeholder image for this popover modal optin form",
SIGNUP_TEXT = "Signup today for free and be the first to get notified on new updates.",
INPUT_PLACEHOLDER = "Enter your email",
SUBMIT_BUTTON = "Subscribe",
SUCCESS_MESSAGE = "Thanks for your subscription!",
ERROR_MESSAGE = "Submitting form failed!",
OPTIN =  true ,
COOKIE_NAME = "mycookie1",
CONTENTLANGUAGE = ""; 
</script>





<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/config/TeX-AMS-MML_HTMLorMML.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    for(var all in MathJax.Hub.getAllJax()) {
        all.SourceElement().parentNode.className += ' has-jax';

    }
});
</script>






  </body>
</html>

